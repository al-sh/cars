# CarsAI — Контекст проекта

## Что это

Веб-сервис подбора легковых автомобилей через диалог с ИИ-ассистентом. Пользователь описывает свои требования в чате, ИИ задаёт уточняющие вопросы и предлагает подходящие варианты из базы данных.

## Роли пользователей

| Роль | Описание | Ключевая задача |
|------|----------|-----------------|
| Клиент | Конечный пользователь | Подобрать автомобиль через чат с ИИ |
| Менеджер | Сотрудник компании | Просмотр чатов клиентов, управление списком клиентов |
| Админ | Системная роль | Управление системой (вне MVP) |

## Скоуп MVP

**Включено:**
- Веб-интерфейс чата для клиентов
- История чатов пользователя
- Панель менеджера: просмотр чатов, CRUD клиентов
- Фильтрация и пагинация в списках
- Локальный деплой через Docker Compose

**Вне скоупа MVP:**
- Мобильные и нативные приложения
- Админ-панель
- Интеграции с внешними сервисами (авто.ру, drom и т.д.)
- Многоязычность
- Восстановление пароля (password reset через email/провайдера)

## Технологический стек

| Слой | Технология | Обоснование |
|------|------------|-------------|
| Frontend | Angular 19, TypeScript | Изучение фреймворка, возможный рабочий проект |
| Backend | Java 21, Spring Boot 3 | Актуализация навыков для рабочего проекта |
| Database | PostgreSQL 16 | Индустриальный стандарт, используется на работе |
| LLM | DeepSeek API | Облачный API, хороший русский язык, не требует локальных ресурсов |
| Reverse Proxy | nginx | Раздача статики, проксирование API |
| Инфраструктура | Docker Compose | Простой локальный деплой (без локального LLM) |

## Архитектурные принципы

### Взаимодействие с LLM

**Принцип:** LLM не имеет доступа к БД. Все запросы к данным выполняет Backend.

```
User → Backend → LLM (извлечь критерии) → Backend → БД → Backend → LLM (форматировать) → User
```

**Направление запросов:** только Backend → LLM (никогда наоборот).

Подробная архитектура: `backend/chat-service.md`

## Ключевые ограничения

| Ограничение | Значение |
|-------------|----------|
| Максимум символов в сообщении | 4000 |
| История в контексте LLM | Последние 20 сообщений или 4000 токенов |
| Rate limit сообщений | 10 в минуту на пользователя |
| Таймаут LLM | 60 секунд |
| DeepSeek API | Требуется API ключ, rate limiting согласно тарифу DeepSeek |
| Поддержка браузеров | Chrome, Firefox, Safari (последние 2 версии) |

## Критерии поиска автомобиля

Для выполнения поиска необходимо:
1. **priceMax** — обязательный параметр
2. **Минимум 2 дополнительных критерия** из списка ниже

Дополнительные критерии:
- **Тип кузова** — седан, кроссовер, хэтчбек, универсал, минивэн
- **Тип двигателя** — бензин, дизель, гибрид, электро
- **Тип КПП** — механика, автомат, робот, вариатор
- **Количество мест** — 5, 7
- **Тип привода** — передний, задний, полный
- **Год выпуска** — от/до
- **Марка** — конкретный бренд

Полный список — см. `contracts/types.md` → CarSearchCriteria.
