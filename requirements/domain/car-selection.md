# Правила подбора автомобиля

Бизнес-логика работы ИИ-ассистента при подборе автомобиля.

---

## Критерии поиска

Полный список критериев — см. `contracts/types.md` → CarSearchCriteria.

### Правила готовности к поиску

Поиск выполняется когда указаны:
1. **priceMax** (обязательный)
2. **Минимум 2 дополнительных параметра** (bodyType, engineType, transmission, seats, drive, brand, yearMin/yearMax)

### Приоритет уточняющих вопросов

| Параметр | Почему важен | Пример вопроса |
|----------|--------------|----------------|
| **Цена** | Определяет сегмент | "На какую сумму рассчитываете?" |
| **Тип кузова** | Функциональность | "Седан, кроссовер, хэтчбек?" |
| **Тип двигателя** | Эксплуатационные расходы | "Бензин, дизель, гибрид?" |
| **КПП** | Удобство | "Автомат или механика?" |
| **Количество мест** | Практичность | "Сколько мест нужно?" |

## Желательные параметры

Уточняются при необходимости сузить выборку:

- Марка/бренд
- Год выпуска (от/до)
- Пробег (для б/у)
- Тип привода (передний/задний/полный)
- Тип КПП (механика/автомат)
- Мощность двигателя
- Расход топлива
- Конкретные опции (камера, круиз, климат и т.д.)

---

## Логика диалога

### 1. Анализ первого сообщения

```
Если указана цена + минимум 2 дополнительных критерия:
  → Сразу выполнить поиск и показать результаты
  
Иначе:
  → Задать уточняющие вопросы (не более 2 за раз)
```

### 2. Стратегия уточнений

- Задавать вопросы по одному-два за сообщение
- Предлагать варианты ответа, когда это уместно
- Не повторять уже известную информацию
- При противоречивых требованиях — уточнять приоритеты

### 3. Выдача результатов

- Показывать 3-5 наиболее релевантных вариантов
- Кратко объяснять, почему каждый вариант подходит
- Предлагать уточнить критерии, если вариантов слишком много/мало

---

## Примеры диалогов

### Идеальный промт (сразу в поиск)

**User:** Ищу семейный 7-местный кроссовер, японский бренд, бензин, до 7 млн, автомат, полный привод, не старше 2021 года.

**Что происходит:**
1. LLM извлекает критерии → `readyToSearch: true`
2. Backend выполняет поиск в БД
3. LLM форматирует результаты

**Assistant:** Нашёл 3 варианта под ваши требования...

### Требуется уточнение

**User:** Нужна надёжная машина для семьи.

**Assistant:** Отличный запрос! Чтобы подобрать оптимальный вариант, уточните:
1. На какую сумму вы рассчитываете?
2. Сколько человек в семье (нужно ли 7 мест)?

### Противоречивые требования

**User:** Хочу очень динамичную машину, но максимально экономичную.

**Assistant:** Динамика и экономичность — обычно компромисс. Что важнее:
- Разгон до 100 за 6-7 сек, но расход 10-12 л?
- Или расход 6-7 л, но разгон 10-11 сек?

---

## Валидация параметров

### Допустимые диапазоны

| Параметр | Минимум | Максимум |
|----------|---------|----------|
| Цена | 100 000 ₽ | 50 000 000 ₽ |
| Год | 2000 | текущий + 1 |
| Мощность | 50 л.с. | 1000 л.с. |
| Расход | 2 л/100км | 30 л/100км |
| Места | 2 | 9 |

### Нормализация ввода

Полный список — см. `domain/llm-prompts.md`, раздел "Нормализация значений".

Примеры:
- "3 млн", "3 миллиона", "3000000" → 3000000
- "кроссовер", "паркетник", "SUV" → suv
- "автомат", "АКПП", "AT" → automatic
- "робот", "роботизированная" → robot
- "вариатор", "CVT" → cvt
- "полный привод", "4WD", "AWD" → awd

---

## Приоритеты при ранжировании

При выдаче результатов учитывать:

1. **Точное соответствие** указанным критериям
2. **Близость к цене** (не показывать на 30%+ дороже priceMax)
3. **Популярность** марки/модели (при прочих равных)
4. **Актуальность** года выпуска (новее — выше)

---

## Ограничения

### Что НЕ делает ассистент

- Не рекомендует конкретных дилеров/продавцов
- Не даёт юридических консультаций
- Не оценивает стоимость конкретного б/у автомобиля
- Не сравнивает с автомобилями вне базы данных
- Не выдумывает характеристики — только данные из БД

### Если нет подходящих вариантов

```
"К сожалению, в базе нет автомобилей с такими параметрами. 
Попробуйте:
- Увеличить максимальную цену до X
- Рассмотреть альтернативный тип кузова
- Расширить диапазон годов выпуска"
```
